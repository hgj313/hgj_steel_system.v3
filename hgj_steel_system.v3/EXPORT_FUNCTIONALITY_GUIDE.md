# 钢材优化系统V3.0 - 导出功能使用指南

## 功能概述

钢材优化系统V3.0现已支持完整的导出功能，可以将优化结果导出为Excel和PDF格式的报告，方便用户保存、分享和打印优化结果。

## 支持的导出格式

### 1. Excel采购清单 (.xlsx)
- **主要用途**：钢材采购和成本核算
- **内容包含**：
  - 详细采购清单（规格、数量、单价、总价）
  - 材料利用率分析
  - 优化结果汇总信息
- **特点**：
  - 双工作表结构：采购清单 + 优化信息
  - 包含成本估算和利用率计算
  - 格式化表格，支持进一步的数据处理
  - 适合采购部门和财务核算

### 2. PDF完整报告 (.pdf)
- **主要用途**：技术分析和方案汇报
- **内容包含**：
  - 优化结果总览
  - 钢材采购清单
  - 切割计划概要
  - 需求匹配验证
  - 优化建议和改进方案
- **特点**：
  - 5个部分的完整技术报告
  - 多页面布局，内容详尽
  - 格式固定，适合打印和分享
  - 包含专业的优化分析和建议

## 使用方法

### 前端界面操作

1. **执行优化**：
   - 在优化页面完成钢材优化计算
   - 等待优化完成并跳转到结果页面

2. **导出报告**：
   - 在结果页面底部找到导出按钮
   - 选择"导出采购清单(Excel)"获取详细的采购信息
   - 选择"导出完整报告(PDF)"获取技术分析报告
   - 等待文件生成和下载

3. **文件保存**：
   - 浏览器会自动下载生成的文件
   - Excel文件名：`钢材优化报告_YYYY-MM-DDTHH-MM-SS.xlsx`
   - PDF文件名：`钢材优化报告_YYYY-MM-DDTHH-MM-SS.pdf`

### API调用方式

#### Excel采购清单导出API
```javascript
// POST /api/export/excel - 导出采购清单
const response = await fetch('/api/export/excel', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    optimizationResult: results,
    exportOptions: {
      format: 'excel',
      includeDetails: true,
      customTitle: '钢材采购清单'
    }
  }),
});
```

#### PDF完整报告导出API
```javascript
// POST /api/export/pdf - 导出完整技术报告
const response = await fetch('/api/export/pdf', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    optimizationResult: results,
    exportOptions: {
      format: 'pdf',
      includeDetails: true,
      customTitle: '钢材优化完整报告'
    }
  }),
});
```

## 导出选项配置

### ExportOptions参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `format` | string | 'excel' | 导出格式：'excel' 或 'pdf' |
| `includeCharts` | boolean | false | 是否包含图表（暂未实现） |
| `includeDetails` | boolean | true | 是否包含详细切割方案 |
| `includeLossRateBreakdown` | boolean | true | 是否包含损耗率分解 |
| `customTitle` | string | undefined | 自定义报告标题 |

## 文件内容详解

### Excel采购清单结构

#### 工作表1：钢材采购清单
- 序号、模数钢材规格、单根长度、采购数量
- 总长度、材料利用率、总金额、备注信息
- 汇总行：总采购成本和整体利用率
- 格式化表格，包含成本估算

#### 工作表2：优化信息
- 优化指标汇总：损耗率、利用率、执行时间等
- 系统生成时间和版本信息

### PDF完整报告结构

1. **优化结果总览**：关键指标和统计数据
2. **钢材采购清单**：表格化的采购信息和成本分析
3. **切割计划概要**：各规格的切割方案统计
4. **需求匹配验证**：满足率和优化状态评估
5. **优化建议**：专业的改进建议和实施方案
6. **页脚信息**：页码和系统版本标识

## 技术实现

### 服务器端依赖
- **ExcelJS**：用于生成Excel文件
- **jsPDF**：用于生成PDF文件

### 前端实现
- 使用fetch API调用导出接口
- 自动处理文件下载和保存
- 错误处理和用户反馈

## 错误处理

### 常见错误及解决方案

1. **"缺少优化结果数据"**
   - 确保已完成优化计算
   - 检查优化结果是否正常

2. **"Excel/PDF导出失败"**
   - 检查服务器是否正常运行
   - 查看服务器日志获取详细错误信息

3. **文件下载失败**
   - 检查浏览器设置
   - 确保有足够的磁盘空间

## 性能优化

### 文件大小优化
- Excel文件：通过合理的数据结构减少文件大小
- PDF文件：使用简洁的布局和字体

### 生成速度优化
- 异步处理大量数据
- 流式写入减少内存占用

## 未来计划

1. **图表支持**：在Excel和PDF中添加图表
2. **模板定制**：支持用户自定义报告模板
3. **批量导出**：支持多个优化结果的批量导出
4. **云存储集成**：支持直接保存到云存储服务

## 更新日志

### v3.0.0 (2025-01-23)
- ✅ 实现Excel采购清单导出功能
- ✅ 实现PDF完整报告导出功能  
- ✅ 明确功能分工：Excel专注采购，PDF专注技术分析
- ✅ 添加成本估算和利用率计算
- ✅ 集成前端导出按钮并更新文案
- ✅ 支持自定义导出选项
- ✅ 完善错误处理机制

---

如有问题或建议，请联系开发团队。 